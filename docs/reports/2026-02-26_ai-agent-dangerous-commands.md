# AIエージェントが実行し得る危険なコマンドの種類と意味（調査レポート）

- 作成日: 2026-02-26 (JST)
- 目的: AIエージェント運用時に、レビュー対象として優先的に警戒すべきコマンドの種類と意味を整理する。
- 対象: ローカル端末、サーバー、コンテナ、クラウドCLI、Git操作を含む一般的なCLI実行

## 前提（重要）

- 「危険」はコマンド名そのものだけでなく、対象パス、オプション、実行権限、実行環境（本番/開発）、認証情報の有無で決まる。
- 下記の例は防御・レビュー観点の整理のための代表例であり、実行を推奨するものではない。
- 同じコマンドでも、`--dry-run` の有無や対象の限定次第で安全性が大きく変わる。

## 1. 危険コマンドの分類一覧（種類と意味）

| 種類 | 意味（何が起きるか） | 代表例（例示） | 主なリスク | AIエージェント運用での注意点 |
| --- | --- | --- | --- | --- |
| 1. ファイル削除・上書き | ファイル/ディレクトリを削除、再帰削除、強制削除、内容消去を行う | `rm -rf ...`, `find ... -delete`, `del /s /q ...`, `Remove-Item -Recurse -Force ...` | データ消失、復旧困難、誤対象削除 | `-r/-R`, `-f`, ワイルドカード、ルート直下、環境変数展開後のパスを要審査 |
| 2. ディスク/パーティション/FS破壊 | ディスク初期化、パーティション変更、ファイルシステム再作成、ブロック単位上書き | `mkfs.*`, `fdisk`, `parted`, `diskpart clean`, `format`, `dd if=... of=...` | OS起動不能、永続データ喪失、全体破壊 | ストレージ系コマンドは原則手動承認。デバイス名 (`/dev/sdX` 等) の誤指定が致命的 |
| 3. 権限/所有者/ACL変更 | 実行権限、所有者、ACL を変更する | `chmod -R ...`, `chown -R ...`, `chgrp`, `icacls`, `takeown` | 過剰権限付与、アクセス不能化、機密漏えい | 再帰オプションと対象範囲を確認。`777` 相当や Everyone 付与は要差し戻し |
| 4. プロセス/サービス停止・再起動 | プロセス kill、サービス停止、OS再起動/停止 | `kill -9`, `pkill`, `systemctl stop`, `Stop-Service`, `taskkill /F`, `shutdown`, `reboot` | 可用性低下、業務停止、データ破損 | 本番環境・DB・キュー系は特に危険。対象プロセス名が曖昧なコマンドを避ける |
| 5. 起動設定/永続化変更 | 自動起動や定期実行に登録、サービス有効化、ログオン時実行を設定 | `crontab`, `systemctl enable`, `schtasks /create`, `reg add ...\\Run` | 意図しない継続実行、検知困難化、設定汚染 | エージェントによる永続化設定は原則禁止または厳格承認 |
| 6. ネットワーク/Firewall/DNS/ルート変更 | 通信経路、名前解決、ファイアウォール設定を変更 | `iptables`, `nft`, `ufw`, `netsh advfirewall`, `route`, `ip route`, `Set-DnsClientServerAddress` | 通信断、迂回通信、監視回避、業務影響 | 影響範囲が広い。変更前バックアップ/現状取得がない場合は実行不可 |
| 7. 外部コード取得・即時実行 | ネットワーク経由で取得した内容をそのままシェル/PowerShellで実行 | `curl ... | sh`, `wget -O- ... | bash`, `Invoke-Expression (iwr ...)` | 任意コード実行、サプライチェーン汚染、追跡性低下 | パイプ実行禁止。取得→保存→署名/ハッシュ確認→レビュー→実行に分離 |
| 8. 認証情報/鍵/設定の変更 | 認証情報、秘密鍵、CLIプロファイル、接続先設定を変更 | `aws configure`, `kubectl config set-*`, `git config credential.*`, `ssh-keygen`（既存鍵上書き時） | 認証失敗、権限昇格、秘密情報漏えい、誤環境接続 | 認証設定変更は監査対象。上書き系プロンプト回避オプションに注意 |
| 9. データ収集・圧縮・転送 | データをまとめて外部へ転送、アップロード、同期する | `tar`, `zip`, `scp`, `rsync`, `curl -T`, `aws s3 cp`, `az storage blob upload`, `gcloud storage cp` | 情報流出、機密データ持ち出し、ログ不足 | 転送先ドメイン/バケット/プロジェクトの許可リストを必須化 |
| 10. DB/クラウド/IaCの破壊的操作 | DB削除/全件更新、クラウド資源削除、IaCで一括破壊 | `DROP DATABASE`, `TRUNCATE`, `terraform destroy`, `aws s3 rm --recursive`, `az group delete`, `gcloud ... delete` | 大規模データ喪失、インフラ停止、復旧コスト大 | 本番アカウントでの destroy/delete は二重承認。対象環境名の検証必須 |
| 11. コンテナ/オーケストレーション削除 | コンテナ、イメージ、ボリューム、K8sリソースを削除 | `docker rm -f`, `docker system prune -a --volumes`, `kubectl delete`, `helm uninstall` | サービス停止、データ消失、クラスタ設定破壊 | `--all`, `--volumes`, namespace 未指定の delete を警戒 |
| 12. Git履歴/作業ツリー改変 | 変更破棄、履歴書き換え、強制 push などを行う | `git reset --hard`, `git clean -fdx`, `git rebase`, `git push --force` | 作業消失、履歴破壊、共同作業事故 | 共有ブランチ操作は承認制。`--hard`/`-fdx`/`--force` は保護対象 |

## 2. コマンド名以外で危険度を上げるパターン

AIエージェントのレビューでは、コマンド名よりも次のパターンが事故を起こしやすいです。

- 強制/再帰/全体指定
  - 例: `-f`, `--force`, `-r`, `-R`, `--recursive`, `/f`, `/q`, `--all`, `-a`
- 対象範囲が広すぎる指定
  - 例: ルート直下、ホーム配下全体、ワイルドカード（`*`）、`.` に対する破壊的操作
- 権限昇格
  - 例: `sudo`, 管理者権限 PowerShell、サービスアカウント実行
- パイプ/連結による即時実行
  - 例: `| sh`, `| bash`, `iex`, `&&`, `;`
- 出力リダイレクトによる上書き
  - 例: `>`, `>>`（設定ファイル、鍵ファイル、認証関連ファイルへの上書き）
- 環境変数/テンプレート展開
  - 例: `$TARGET_DIR`, `%USERPROFILE%` が意図せず空や広範囲を指すケース

## 3. AIエージェント運用時の推奨ガードレール

### 実行ポリシー（最低限）

- 破壊系コマンドはデフォルト拒否（削除、destroy、format、delete、prune、reset --hard など）
- 外部コードの即時実行を禁止（`curl|sh`、`iex(iwr ...)` 等）
- 権限昇格を伴うコマンドは手動承認必須
- 本番環境・本番資格情報を使うCLIは手動承認必須
- 設定変更系（Firewall、DNS、起動設定、認証設定）は承認と監査ログ必須

### レビュー時のチェックポイント

- 対象はどこか（パス、namespace、DB名、サブスクリプション、プロジェクトID）
- 実行環境はどこか（ローカル/検証/本番）
- 破壊性フラグは含まれるか（`--force`, `--recursive`, `--all` など）
- 復旧手段はあるか（バックアップ、dry-run、ロールバック）
- 実行目的は明確か（なぜ必要か、代替はないか）

### 実装側での防止策（例）

- コマンド許可リスト（Allowlist）方式にする
- 危険トークン検出（`rm -rf`, `destroy`, `format`, `drop`, `prune`, `--force` など）
- `--dry-run` / `plan` / `preview` を優先する実行ラッパーを使う
- 実行前に対象を再表示して確認（パス・環境・件数）
- ネットワークアクセスや秘密情報へのアクセスをサンドボックスで制限する

## 4. まとめ

- 危険コマンドは「削除/破壊」だけでなく、「権限変更」「永続化」「外部取得実行」「情報転送」「クラウド/DB削除」「Git履歴改変」も重要。
- AIエージェント運用では、コマンド名単体より「対象範囲」「強制フラグ」「権限昇格」「外部コード即時実行」の組み合わせを重点的に監視するべき。
- 実務上は、禁止リストだけでなく「許可リスト + 承認フロー + dry-run + 監査ログ」の組み合わせが有効。
