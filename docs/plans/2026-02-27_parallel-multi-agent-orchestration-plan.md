# 計画書: 並列マルチエージェント実行オーケストレーション

## 0. 依頼概要
- 依頼内容:
  - 必要に応じて複数のエージェントを利用し、並列で実行できるようにしたい。
  - 上記を新規タスクとして運用計画へ追加したい。
- 背景:
  - 現行設計では役割分離（Planner/Researcher/Executor/Reviewer）は定義済みだが、並列実行時の制御規約が不足している。
- 期待成果:
  - 並列実行の条件・分割単位・同期方法・失敗時ハンドリングを明文化し、実行可能なタスクに落とし込む。

## 1. ゴール / 完了条件
- ゴール:
  - 依頼内容に応じて、単一エージェント実行と並列マルチエージェント実行を安全に切り替えられる運用を定義する。
- 完了条件（DoD）:
  - 並列化判定基準（いつ並列化するか）が定義されている。
  - オーケストレータとワーカーの責務、入出力、同期点が定義されている。
  - 競合回避ルール（ファイル分割、ロック方針、マージ手順）が定義されている。
  - 失敗時の再試行・縮退（並列→直列）手順が定義されている。
  - REPORT に並列実行証跡（担当・開始/終了・成果物・統合結果）を残すフォーマットがある。

## 2. スコープ
- In Scope:
  - 並列マルチエージェント運用ルールの設計
  - タスク分割・同期・統合のプロトコル定義
  - 安全ガード（承認境界、ロールバック）との整合
  - テンプレート/ドキュメント反映計画
- Out of Scope:
  - 実際の並列実行エンジン実装
  - 外部キュー/ジョブ管理基盤の導入

## 3. 実行タスク
- [ ] 1. 並列化対象判定基準を定義する（独立性、影響範囲、検証容易性）。
- [ ] 2. エージェント構成を定義する（Orchestrator + Worker群）。
- [ ] 3. タスク分割規約を定義する（ファイル責務境界、依存順序、同期点）。
- [ ] 4. 競合回避規約を定義する（同一ファイル排他、統合担当、競合解消優先順位）。
- [ ] 5. 失敗時制御を定義する（再試行回数、タイムアウト、縮退運転）。
- [ ] 6. 承認境界との整合を定義する（L1/L2/L3 での並列実行可否）。
- [ ] 7. REPORT 記録フォーマットを拡張する（エージェント別ログ + 統合結果）。
- [ ] 8. パイロットシナリオを2件設計し、評価観点を定義する。

## 4. マイルストーン
- M1: 並列化判定基準と役割定義確定（タスク1-2完了）
- M2: 分割/競合/失敗時制御の実行規約確定（タスク3-6完了）
- M3: ログ拡張とパイロット評価設計完了（タスク7-8完了）

## 5. リスクと対策
- リスク:
  - 並列化による競合で差分品質が低下する。
  - 対策:
    - 同一ファイル排他と統合担当を固定する。
- リスク:
  - オーケストレーション手順が複雑化し、運用コストが上がる。
  - 対策:
    - 並列化は「独立タスク」に限定し、直列縮退手順を必ず用意する。
- リスク:
  - 複数エージェントで責任境界が曖昧になる。
  - 対策:
    - エージェントごとのDoDと成果物責務を明示する。

## 6. 検証方法
- 実施する確認:
  - 並列化判定基準に基づき、並列可否が一貫して判断できるか。
  - 同期点と統合ルールに従い、差分競合を再現可能に解消できるか。
  - REPORT だけで担当・進行・統合結果を追跡できるか。
- 成功判定:
  - 2件のパイロットシナリオで、並列運用フローを手順通り説明できる。
  - 失敗時に縮退運転手順へ切り替え可能であることを確認できる。

## 7. 成果物
- 変更ファイル:
  - `docs/plans/2026-02-27_parallel-multi-agent-orchestration-plan.md`
  - `docs/plans/2026-02-27_codex-autonomy-research-loop-plan.md`（新規タスク追記）
- 付随ドキュメント:
  - `docs/reports/*`（評価記録）
  - `docs/agent/*`（必要時の運用指示反映）

## 8. 備考
- 並列化は目的ではなく手段とし、品質・安全性が低下する場合は直列実行を優先する。
- 本計画は「運用設計」。実装着手時は別runでパイロット検証を実施する。
