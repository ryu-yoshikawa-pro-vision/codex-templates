# 計画書: Codex自律運用・仮説検証ループ整備

## 0. 依頼概要
- 依頼内容:
  - スキルを見つけるスキルを導入したい。
  - Codexが自律的に考えられるように、用途別エージェント/スキル/思考用Markdownを整備したい。
  - ユーザー入力に対して `PLAN ->（不足知識のWeb検索）-> TASKS -> 実行 -> REPORT記録` を標準フロー化したい。
  - 現状の `AGENTS.md` とプロジェクト構成を見直し、自己改善提案までできる状態にしたい。
- 背景:
  - 現在の運用は PLAN/TASKS/REPORT の枠組みはあるが、「検索主導の仮説検証」と「自律改善提案」の手順が明文化されていない。
- 期待成果:
  - 反復的なWeb調査と仮説更新を前提にした運用設計（ルール/テンプレート/実行手順）を確立する。

## 1. ゴール / 完了条件
- ゴール:
  - Codexが依頼ごとに計画・調査・実行・記録を自己管理し、必要時に改善提案を返せる運用へ移行する。
- 完了条件（DoD）:
  - 「スキル探索・導入」運用（`skill-installer` の活用手順を含む）が `AGENTS.md` または補助ドキュメントに反映されている。
  - 用途別のエージェント役割（例: Planner / Researcher / Executor / Reviewer）と、それぞれの入力・出力・責務が定義されている。
  - 必要時に複数エージェントを並列実行できるよう、オーケストレーション方針（分割・同期・統合）が定義されている。
  - `PLAN -> Web検索 -> TASKS -> 実行 -> REPORT` の状態遷移と必須記録項目がテンプレート化されている。
  - `AGENTS.md` と関連ドキュメントの差分レビューが完了し、運用の矛盾が解消されている。
  - 主要仮説ごとに「支持証拠」「反証」「暫定結論」「信頼度」が記録され、未解決論点が管理されている。
  - 自己改善提案に対して、採用可否判断（承認者・理由・影響範囲・ロールバック方針）が記録されている。

## 2. スコープ
- In Scope:
  - スキル探索・導入フローの設計（既存スキル棚卸し、候補選定、導入手順）
  - 調査主導ワークフロー（仮説、検索、検証、更新）の標準化
  - run artifacts（PLAN/TASKS/REPORT）と `AGENTS.md` の整合ルール再設計
  - 自己改善提案のトリガー条件と提案フォーマット定義
- Out of Scope:
  - すべての新規スキル実装（本計画では優先順位付けまで）
  - 外部SaaS契約・組織ポリシー承認が必要な運用変更
  - 長期運用KPIの最終確定（初期KPIのみ定義）

## 3. 実行タスク
- [ ] 1. 現状分析: `AGENTS.md` / `docs/PROJECT_CONTEXT.md` / `.codex/runs` から運用ギャップを抽出する。
- [ ] 2. 仮説定義: 「自律性を阻害している要因」の仮説を3-5件定義し、検証観点を作る。
- [ ] 3. 証跡設計: 検索ログ/仮説評価ログの記録フォーマット（クエリ、出典、採否理由、信頼度、未解決論点）を定義する。
- [ ] 4. Web調査ラウンド1: 公式ドキュメント中心に情報収集し、仮説ごとにエビデンスを紐付ける。
- [ ] 5. 調査結果レビュー1: ラウンド1で不足した論点を明確化し、追加検索クエリを更新する。
- [ ] 6. Web調査ラウンド2+: 終了条件（主要仮説の支持/反証が揃う、未解決論点が管理可能）を満たすまで検索と仮説更新を反復する。
- [ ] 7. スキル探索・導入設計: `skill-installer` を起点に、導入対象スキルと導入手順を決定する。
- [ ] 8. 自律エージェント設計: 役割別エージェント、利用スキル、思考用Markdownテンプレートを設計する。
- [ ] 9. 実行プロトコル設計: `PLAN -> Web検索 -> TASKS -> 実行 -> REPORT` を手順化し、記録必須項目を定義する。
- [ ] 10. 改善提案ガードレール設計: 提案のトリガー、承認フロー、差し戻し条件、ロールバック方針を定義する。
- [ ] 11. ドキュメント改訂: `AGENTS.md` と関連ドキュメントを更新し、自己改善提案フローを追加する。
- [ ] 12. パイロット検証: 代表ユースケースで新運用を試行し、改善提案の妥当性を評価する。
- [ ] 13. 並列マルチエージェント実行設計: 必要時に複数エージェントを並列実行するためのオーケストレーション規約を定義する。

## 4. マイルストーン
- M1: 現状ギャップと仮説セット確定（タスク1-2完了）
- M2: 証跡フォーマット確定と反復Web調査完了（タスク3-6完了）
- M3: 設計ドラフト確定（スキル導入/エージェント/実行プロトコル/ガードレール）（タスク7-10完了）
- M4: ドキュメント反映とパイロット検証完了（タスク11-12完了）
- M5: 並列マルチエージェント実行設計の確定（タスク13完了）

## 5. リスクと対策
- リスク: Web検索の情報が断片的で、誤った前提に引きずられる。
  - 対策: 公式一次情報優先、出典URL必須、仮説ごとに反証チェックを入れる。
- リスク: 自律化ルールを増やしすぎて運用コストが上がる。
  - 対策: MUST/SHOULD を分離し、必須ルールは最小集合から開始する。
- リスク: ドキュメント更新だけで実運用に定着しない。
  - 対策: パイロット実行を DoD に含め、REPORT に失敗ケースを必ず残す。
- リスク: 改善提案が過剰に自動化され、意図しない変更を誘発する。
  - 対策: 変更種別ごとに承認レベルを分離し、高リスク変更は必ずユーザー承認を必須化する。

## 6. 検証方法
- 実施する確認:
  - 反復検索ログ（クエリ、結果、採否理由、信頼度、未解決論点）が REPORT に記録されていること。
  - 各依頼で `PLAN/TASKS/REPORT` が時系列に連動していること。
  - エージェントが改善提案を返す条件と実例が確認できること。
  - 改善提案の採用/却下/差し戻しの判断ログが残っていること。
- 成功判定:
  - パイロット実行で、再現可能な計画・実行・記録フローが2サイクル以上成立する。
  - 主要仮説（P0/P1）について、支持証拠と反証が最低1件ずつ紐づき、結論が更新されている。
  - 未解決論点が「次アクション付き」で管理され、放置項目がない。

## 7. 成果物
- 変更ファイル:
  - `AGENTS.md`
  - `docs/PROJECT_CONTEXT.md`
  - `docs/agent/overrides.md`（必要時）
  - `.codex/templates/PLAN.md`
  - `.codex/templates/TASKS.md`
  - `.codex/templates/REPORT.md`
- 付随ドキュメント:
  - `docs/plans/2026-02-27_codex-autonomy-research-loop-plan.md`（本計画）
  - `docs/plans/2026-02-27_parallel-multi-agent-orchestration-plan.md`（並列実行の追加計画）
  - `docs/reports/*`（調査ラウンドごとの検証ログ）
  - `docs/adr/*`（重要な設計判断が発生した場合）

## 8. 備考
- 調査ラウンドは最低2回実施し、各ラウンド後に仮説とタスクを更新する。
- 自律性向上は「勝手に実行すること」ではなく、「根拠を明示して提案・実行・記録できること」を基準とする。
- レビュー運用は「懸念抽出 -> 修正 -> 再レビュー」を1セットとし、重大/中程度の懸念がゼロになるまで反復する。
